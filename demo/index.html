<!DOCTYPE html>
<html class="js no-touchevents" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Franklin Online</title>
    <link async rel="stylesheet" href="./css/style.css">
    <link async rel="stylesheet" href="./css/styles.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,600,300italic,600italic" rel="stylesheet" type="text/css">
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#29BDBB">
    <link rel="icon" sizes="192x192" href="./launcher-icon-144.png">
    <script type = "text/javascript">

      </script>
</head>

<body onload="start()" style.backgroundColor="#12476A">
  <script>


           //prefixes of implementation that we want to test
           window.indexedDB = window.indexedDB || window.mozIndexedDB ||
           window.webkitIndexedDB || window.msIndexedDB;

           //prefixes of window.IDB objects
           window.IDBTransaction = window.IDBTransaction ||
           window.webkitIDBTransaction || window.msIDBTransaction;
           window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange ||
           window.msIDBKeyRange

           if (!window.indexedDB) {
              window.alert("Your browser doesn't support a stable version of IndexedDB.")
           }
           var request = new XMLHttpRequest();
           request.open('GET', './api/db.json');
           var tempArr;
           request.onload = function() {
               // success
               if (request.status === 200) {
                   // resolve the promise with the parsed response text (assumes JSON)
                   tempArr = JSON.parse(request.response);
               } else {
                   // error retrieving file
                   Error(request.statusText);
               }
           };

           request.onerror = function() {
               // network errors
               reject(Error("Network Error"));
           };
           const pumpIndexList = [
              { id: "1", name: "FPS SS Series", img: "fps_ss_series.png" },
              { id: "2", name: "FPS FS Series", img: "fps_fs_series.png" },
              { id: "3", name: "Subdive Solar", img: "subdrive_solar.png" },
              { id: "4", name: "SVM Borehole Pump", img: "svm_borehole_pump.png" }
            ];

              var tempStr = JSON.stringify(pumpIndexList);
              console.log(tempStr);

           var db;
           var request = window.indexedDB.open("PumpDatabase", 1);

           request.onerror = function(event) {
              console.log("error: ");
           };

           request.onsuccess = function(event) {
              db = request.result;
              console.log("success: "+ db);
           };

           request.onupgradeneeded = function(event) {
              var db = event.target.result;
              var objectStore = db.createObjectStore("pumps", {keyPath: "id"});

              for (var i in pumpIndexList) {
                 objectStore.add(pumpIndexList[i]);
              }
           }

           function read() {
              var transaction = db.transaction(["pumps"]);
              var objectStore = transaction.objectStore("pumps");
              var request = objectStore.get("1");

              request.onerror = function(event) {
                 alert("Unable to retrieve data from database!");
              };

              request.onsuccess = function(event) {
                 // Do something with the request.result!
                 if(request.result) {
                    alert("Name: " + request.result.name + ", Age: " + request.result.age + ", Email: " + request.result.email);
                 } else {
                    alert("Kenny couldn't be found in your database!");
                 }
              };
           }

           function readAll() {
              var objectStore = db.transaction("pumps").objectStore("pumps");
              objectStore.openCursor().onsuccess = function(event) {
                 var cursor = event.target.result;

                 if (cursor) {
                       addTile("m" + cursor.key,cursor.value.name,cursor.value.img)
                    cursor.continue();
                 }
              };
                objectStore.openCursor().onerror = function(event) {
                    alert("Error connecting to database")
                };
           }

           function add() {
              var request = db.transaction(["employee"], "readwrite")
              .objectStore("employee")
              .add({ id: "00-03", name: "Kenny", age: 19, email: "kenny@planet.org" });

              request.onsuccess = function(event) {
                 alert("Kenny has been added to your database.");
              };

              request.onerror = function(event) {
                 alert("Unable to add data\r\nKenny is aready exist in your database! ");
              }
           }

           function remove() {
              var request = db.transaction(["employee"], "readwrite")
              .objectStore("employee")
              .delete("00-03");

              request.onsuccess = function(event) {
                 alert("Kenny's entry has been removed from your database.");
              };
           }

  function start()
  {
    setTimeout(function () {
      readAll();
    }, 200);
  }


  function onChoice(id)
  {
      document.getElementById("grid").innerHTML = id
      var url = "ProductPage.html?product=" + id.substring(1);
      window.location = url;
  }


  function addTile(id,name,img) {
      var tile = document.createElement('div');
      tile.id = id;
      tile.className = "tile";
      tile.onclick = function(){onChoice(tile.id);};
      tile.style.backgroundImage = "url('./images/"+img+"')";
      tile.style.backgroundColor = "#ffffff"
      var txt = document.createElement('div');
      txt.className = "textWrapper";
      var h2 = document.createElement('h2');
      h2.innerHTML = name;
      var div2 = document.createElement('div');
      div2.className = "content";
      txt.appendChild(h2);
      txt.appendChild(div2);
      tile.appendChild(txt);
      h2.align = "center"
      document.getElementById("grid").appendChild(tile);
  }


  </script>
  <div id= "logoDiv" style="width:105.2%; margin-left:-10px; margin-top:-15px; padding-top: 15px;" align="center" onclick="readAll()"><img src="./images/logo.png" height="49" border="0" /></div>
  <label id="id" style="visibility: none;"></label>
<!-- Header -->
<div id="grid" class="imageGrid">
    <!-- Dynamic Images from Index inserted here -->
  </div>

</div>
   <script src="./js/build/vendor.min.js"></script>
    <script src="./js/build/script.min.js"></script>
</body>

</html>
